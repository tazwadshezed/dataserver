/*
 Copyright 2013 Draker - Pats Pending
*/
define(["jquery","static/_build/scripts/modules/urls"],function(p){ss.devices={};ss.devices.device={isChildOf:function(b){var a=!1;if(this.parentNodes)for(var c in this.parentNodes)if(this.parentNodes[c][0]===b){a=!0;break}return a},isParentOf:function(b){var a=!1;if(b=ss.devices.allNodesById[b].parentNodes)for(var c in b)if(b[c][0]===this.id){a=!0;break}return a}};ss.devices.dataDefer=p.ajax({url:ss.urls.getDevices,cache:!1,success:function(b){ss.devices.allData=b;ss.devices.nodeTypes=b.sitearray.devtypes.split(",");ss.devices.nodeTypes[0].replace(" ",
"");if(b.sitearray&&b.sitearray.inputs){ss.devices.allNodesById={};ss.devices.allNodesByType={};var a=Object.create(ss.devices.device);p.extend(a,{id:b.sitearray.id,label:b.sitearray.label,inputs:b.sitearray.inputs,devtype:"SiteArray",shapes:b.sitearray.shapes,childNodeCount:{}});for(var c=0,r=ss.devices.nodeTypes.length;c<r;c++){var e=ss.devices.nodeTypes[c].toLowerCase();"site array"!==e&&(a.childNodeCount[e]=+ss.devices.allData.sitearray[e+"s"])}ss.devices.allNodesByType.SiteArray=a;ss.devices.allNodesById[b.sitearray.id]=
a;a=b.sitearray.inputs;c=0;for(r=a.length;c<r;c++){e=Object.create(ss.devices.device);p.extend(e,a[c]);ss.devices.allNodesByType[a[c].devtype.replace(/\//g,"")]||(ss.devices.allNodesByType[a[c].devtype.replace(/\//g,"")]=[]);e.parentNodes={};e.parentNodes.SiteArray=[b.sitearray.id,b.sitearray.label];var h=a[c].inputs;if(h&&0<h.length){e.childNodeCount={};e.childNodeCount[h[0].devtype]=h.length;for(var i=0,s=h.length;i<s;i++){var j=Object.create(ss.devices.device);p.extend(j,h[i]);ss.devices.allNodesByType[h[i].devtype.replace(/\//g,
"")]||(ss.devices.allNodesByType[h[i].devtype.replace(/\//g,"")]=[]);j.parentNodes={};j.parentNodes.SiteArray=[b.sitearray.id,b.sitearray.label];j.parentNodes[a[c].devtype.replace(/\//g,"")]=[a[c].id,a[c].label];var g=h[i].inputs;if(g&&0<g.length){e.childNodeCount[g[0].devtype]=e.childNodeCount[g[0].devtype]?e.childNodeCount[g[0].devtype]+g.length:g.length;j.childNodeCount={};j.childNodeCount[g[0].devtype]=g.length;for(var l=0,t=g.length;l<t;l++){var k=Object.create(ss.devices.device);p.extend(k,
g[l]);ss.devices.allNodesByType[g[l].devtype.replace(/\//g,"")]||(ss.devices.allNodesByType[g[l].devtype.replace(/\//g,"")]=[]);k.parentNodes={};k.parentNodes.SiteArray=[b.sitearray.id,b.sitearray.label];k.parentNodes[a[c].devtype.replace(/\//g,"")]=[a[c].id,a[c].label];k.parentNodes[h[i].devtype.replace(/\//g,"")]=[h[i].id,h[i].label];var f=g[l].inputs;if(f&&0<f.length){e.childNodeCount[f[0].devtype]=e.childNodeCount[f[0].devtype]?e.childNodeCount[f[0].devtype]+f.length:f.length;j.childNodeCount[f[0].devtype]=
j.childNodeCount[f[0].devtype]?j.childNodeCount[f[0].devtype]+f.length:f.length;k.childNodeCount={};k.childNodeCount[f[0].devtype]=f.length;for(var o=0,u=f.length;o<u;o++){var m=Object.create(ss.devices.device);p.extend(m,f[o]);ss.devices.allNodesByType[f[o].devtype.replace(/\//g,"")]||(ss.devices.allNodesByType[f[o].devtype.replace(/\//g,"")]=[]);m.parentNodes={};m.parentNodes.SiteArray=[b.sitearray.id,b.sitearray.label];m.parentNodes[a[c].devtype.replace(/\//g,"")]=[a[c].id,a[c].label];m.parentNodes[h[i].devtype.replace(/\//g,
"")]=[h[i].id,h[i].label];m.parentNodes[g[l].devtype.replace(/\//g,"")]=[g[l].id,g[l].label];var d=f[o].inputs;if(d&&0<d.length){e.childNodeCount[d[0].devtype]=e.childNodeCount[d[0].devtype]?e.childNodeCount[d[0].devtype]+d.length:d.length;j.childNodeCount[d[0].devtype]=j.childNodeCount[d[0].devtype]?j.childNodeCount[d[0].devtype]+d.length:d.length;k.childNodeCount[d[0].devtype]=k.childNodeCount[d[0].devtype]?k.childNodeCount[d[0].devtype]+d.length:d.length;m.childNodeCount={};m.childNodeCount[d[0].devtype]=
d.length;for(var q=0,v=d.length;q<v;q++){var n=Object.create(ss.devices.device);p.extend(n,d[q]);ss.devices.allNodesByType[d[q].devtype.replace(/\//g,"")]||(ss.devices.allNodesByType[d[q].devtype.replace(/\//g,"")]=[]);n.parentNodes={};n.parentNodes.SiteArray=[b.sitearray.id,b.sitearray.label];n.parentNodes[a[c].devtype.replace(/\//g,"")]=[a[c].id,a[c].label];n.parentNodes[h[i].devtype.replace(/\//g,"")]=[h[i].id,h[i].label];n.parentNodes[g[l].devtype.replace(/\//g,"")]=[g[l].id,g[l].label];n.parentNodes[f[o].devtype.replace(/\//g,
"")]=[f[o].id,f[o].label];ss.devices.allNodesById[n.id]=n;ss.devices.allNodesByType[n.devtype.replace(/\//g,"")].push(n)}}ss.devices.allNodesById[m.id]=m;ss.devices.allNodesByType[m.devtype.replace(/\//g,"")].push(m)}}ss.devices.allNodesById[k.id]=k;ss.devices.allNodesByType[k.devtype.replace(/\//g,"")].push(k)}}ss.devices.allNodesById[j.id]=j;ss.devices.allNodesByType[h[i].devtype.replace(/\//g,"")].push(j)}}ss.devices.allNodesById[e.id]=e;ss.devices.allNodesByType[e.devtype.replace(/\//g,"")].push(e)}}},
error:function(){throw"Device data failed to load";}});return ss.devices});