define(["jquery","static/_build/scripts/modules/devices"],function(i, k){ss.arrayNav={_init:function(b, a){var c=this;this.element=a;this.$element=i(a);k.dataDefer.done(function(){var a=window.location.hash.replace("#","")||!1;c.arrayData=k.allData.sitearray;c._build();a&&c.setActiveDevice(a);c._addListeners()})},_build:function(){var b=this.arrayData,a=[];a.push('<div id="array_'+b.id+'" class="array"><a href="#'+b.id+'" class="deviceNavigation">'+b.location+"</a></div>");var c=function(a){var b="";"null"===a||null===a?b="uncommissioned":
"SPO"===a&&(b="optimized");return b};if(b.inputs&&0<b.inputs.length){a.push('<ul class="collapsible">');for(var g=0,i=b.inputs.length;g<i;g++){var d=b.inputs[g];if("Inverter"===d.devtype)if(a.push('<li id="'+d.devtype.replace(/\//g,"")+"_"+d.id+'" class="'+d.devtype.replace(/\//g,"")+' collapsed"><span class="wrapper_expandCollapse"><a href="#'+d.id+'" class="deviceNavigation">'+d.label+"</a></span>"),d.inputs&&0<d.inputs.length){a.push('<ul class="group_'+d.devtype.replace(/\//g,"")+'" style="display:none;">');
for(var n=0,k=d.inputs.length;n<k;n++){var h=d.inputs[n];a.push('<li id="'+h.devtype.replace(/\//g,"")+"_"+h.id+'" class="'+h.devtype.replace(/\//g,"")+' collapsed"><span class="wrapper_expandCollapse"><a href="#'+h.id+'" class="deviceNavigation">'+h.label+"</a></span>");if(h.inputs&&0<h.inputs.length){a.push('<ul class="group_'+h.devtype.replace(/\//g,"")+'" style="display:none;">');for(var o=0,q=h.inputs.length;o<q;o++){var e=h.inputs[o],l="Panel"===e.devtype?c(e.attached):"";a.push('<li id="'+
e.devtype.replace(/\//g,"")+"_"+e.id+'" class="'+l+" "+e.devtype.replace(/\//g,"")+' collapsed"><span class="wrapper_expandCollapse"><a href="#'+e.id+'" class="deviceNavigation">'+e.label+"</a></span>");if(e.inputs&&0<e.inputs.length){a.push('<ul class="group_'+e.devtype.replace(/\//g,"")+'" style="display:none;">');for(var l=0,r=e.inputs.length;l<r;l++){var f=e.inputs[l],m="Panel"===f.devtype?c(f.attached):"";a.push('<li id="'+f.devtype.replace(/\//g,"")+"_"+f.id+'" class="'+m+" "+f.devtype.replace(/\//g,
"")+' collapsed"><span class="wrapper_expandCollapse"><a href="#'+f.id+'" class="deviceNavigation">'+f.label+"</a></span>");if(f.inputs&&0<f.inputs.length){a.push('<ul class="group_'+f.devtype.replace(/\//g,"")+'" style="display:none;">');for(var m=0,s=f.inputs.length;m<s;m++){var j=f.inputs[m],t="Panel"===j.devtype?c(j.attached):"";a.push('<li id="'+j.devtype.replace(/\//g,"")+"_"+j.id+'" class="'+t+" "+j.devtype.replace(/\//g,"")+' collapsed"><span class="wrapper_expandCollapse"><a href="#'+j.id+
'" class="deviceNavigation">'+j.label+"</a></span></li>")}a.push("</ul>")}else"String"==f.devtype&&a.push('<ul class="noDeviceMonitors"><li>No device monitors found</li></ul>');a.push("</li>")}a.push("</ul>")}else"String"==e.devtype&&a.push('<ul class="noDeviceMonitors"><li>No device monitors found</li></ul>');a.push("</li>")}a.push("</ul>")}else"String"==h.devtype&&a.push('<ul class="noDeviceMonitors"><li>No device monitors found</li></ul>');a.push("</li>")}a.push("</ul>")}else"String"==d.devtype&&
a.push('<ul class="noDeviceMonitors"><li>No device monitors found</li></ul>')}a.push("</ul>")}else a.push('<p class="message warning">No devices found</p>');this.$element.find("img.loading").hide();this.$element.append(a.join(""))},setActiveDevice:function(b){var a=this,b=k.allNodesById[b];this.$element.find("span.activeIndicator").remove();if("SiteArray"!==b.devtype){var c=this.$element.find("li#"+b.devtype+"_"+b.id),g=this.$element.parent(),p=g.scrollTop();c.prepend('<span class="activeIndicator" />');
var d=function(){var a=c.offset();(0>a.top||a.top>g.height())&&g.animate({scrollTop:p+a.top-100},500)};c.parent().is(":visible")?d():i.each(c.parents("ul"),function(){var b=i(this);b.is(":visible")||a.expand(b,!0,d)})}},collapse:function(b,a,c){var g=this.$element.find(b),c=c||function(){};!1==a||""==a||void 0==a?(g.hide(),c()):g.animate({height:"hide"},250,function(){}).promise().done(c());g.each(function(){g.parent().addClass("collapsed")})},expand:function(b,a,c){c=c||function(){};!1==a||""==a||
void 0==a?(b.show(),c()):b.animate({height:"show"},250,function(){}).promise().done(c());b.each(function(){b.parent().removeClass("collapsed")})},toggle:function(b,a){b.is(":visible")?this.collapse(b,a.animate):this.expand(b,a.animate)},_addListeners:function(){var b=this;i(document).bind("setDevice",function(a,c){b.setActiveDevice(c.deviceId)});this.$element.delegate(".wrapper_expandCollapse","click",function(a){a.stopPropagation();a=i("#"+i(this).parent().attr("id")+" > ul");b.toggle(a,{animate:!0})});
this.$element.delegate("a.deviceNavigation","click",function(a){a.preventDefault();a.stopPropagation();i(document).trigger("setDevice",{deviceId:i(this).attr("href").replace("#","")})})}};return ss.arrayNav});