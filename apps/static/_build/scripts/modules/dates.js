/*
 Copyright 2013 Draker - Pats Pending
*/
define(["jquery","datepicker"],function(a){ss.dates={today:new Date,min:function(c){var b=a("input[name=min_date]").length&&a("input[name=min_date]").val()?a("input[name=min_date]").val().split("-"):[this.today.getFullYear(),this.today.getMonth()+1,this.today.getDate()];return"UTC"===c||"utc"===c?Date.UTC(+b[0],+b[1]-1,+b[2]):b[0]+"-"+b[1]+"-"+b[2]},max:function(c){var b=a("input[name=max_date]").length&&a("input[name=max_date]").val()?a("input[name=max_date]").val().split("-"):[this.today.getFullYear(),
this.today.getMonth()+1,this.today.getDate()];return"UTC"===c||"utc"===c?Date.UTC(+b[0],+b[1]-1,+b[2]):b[0]+"-"+b[1]+"-"+b[2]},template:function(a){if("advanced"===a.type)return['<div class="dateSelection">','<form id="dateSelection_'+a.id+'" name="dateSelection_'+a.id+'">','<ul class="dateRangeSelection"><li><a href="#week" class="dateRange">Week</a></li><li><a href="#3day" class="dateRange">3 Day</a></li><li><a href="#yesterday" class="dateRange">Yesterday</a></li><li><a href="#today" class="dateRange">Today</a></li></ul><a class="btn_selectDate"></a><input type="hidden" name="min_date" value=""><input type="hidden" name="max_date" value=""><div class="calendar"></div></form></div>'].join("")},
date:{_init:function(c,b){this.options=a.extend({},this.options,c);this.$element=a(ss.dates.template(this.options));this.element=this.$element[0];b?a(b).append(this.$element):a(".container_modules").append(this.$element);this.active=!1;this.dateMin=c.dateMin||ss.dates.min();this.dateMax=c.dateMax||ss.dates.max();a('input[name$="min_date"]').val(this.dateMin);a('input[name$="max_date"]').val(this.dateMax);this.$element.find(".btn_selectDate").text(this.dateMin+" - "+this.dateMax);var d=this;this.$calendar=
a(".dateSelection .calendar").DatePicker({flat:!0,date:[this.dateMin,this.dateMax],calendars:3,mode:"range",starts:0,onChange:function(a){d.dateMin=a[0];d.dateMax=a[1];d.$element.find(".btn_selectDate").text(a[0]+" - "+a[1])},onRender:function(a){return{disabled:a.valueOf()>new Date}}});a(".dateSelection .calendar").append('<div class="btnContainer"><button type="submit" class="button secondary submit">Update Time</button></div>');a(".dateSelection .calendar").hide();this._addListeners()},toggle:function(){!1==
this.active?(a(".dateSelection .calendar").slideToggle(),a(".dateSelection .btn_selectDate").addClass("active"),this.active=!0):(a(".dateSelection .calendar").slideToggle(),a(".dateSelection .btn_selectDate").removeClass("active"),this.active=!1,a(".btn_selectDate").text(a('input[name$="min_date"]').val()+" - "+a('input[name$="max_date"]').val()),a(".dateSelection .calendar").DatePickerSetDate([a('input[name$="min_date"]').val(),a('input[name$="max_date"]').val()],!0))},setRange:function(a){var b=
new Date,d=new Date(b-864E5);switch(a){case "today":a=b;break;case "yesterday":b=a=d;break;case "3day":a=new Date(d-1728E5);b=d;break;case "week":a=new Date(d-5184E5);b=d;break;default:a=b}this.dateMin=a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2);this.dateMax=b.getFullYear()+"-"+("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2);this.$element.find(".btn_selectDate").text(this.dateMin+" - "+this.dateMax);this.submit()},_addListeners:function(){var c=
this;a(".btn_selectDate").click(function(){c.toggle()});this.$element.find("form").submit(function(b){b.preventDefault();c.submit(a(this))});a("html").click(function(){!0==c.active&&c.toggle()});a(".dateSelection").click(function(a){a.stopPropagation()});a(".dateRangeSelection li a").click(function(b){b.preventDefault();a(".dateRangeSelection").find("li.active").removeClass("active");a(this).addClass("active");c.setRange(a(this).attr("href").replace("#",""))})},submit:function(){var c=this,b=this.$element.find("form");
a('input[name$="min_date"]').val(c.dateMin);a('input[name$="max_date"]').val(c.dateMax);!0==c.active&&c.toggle();a.post(ss.urls.setDate,b.serialize()).success(function(){a(".dateSelection .calendar").DatePickerSetDate([c.dateMin,c.dateMax],!0);a(document).trigger("setDate",{date:[c.dateMin,c.dateMax]});a(document).trigger("updateModules")})},options:{type:"advanced",dateMin:"",dateMax:""}}};return ss.dates.date});